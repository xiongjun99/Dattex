package com.temp.buda.fragments.home;

<<<<<<< HEAD:DattEx/src/main/java/com/temp/buda/fragments/home/HomeFragment.java
import android.content.Intent;
=======
>>>>>>> e7f6ac6e40e0fba4e4d97456712a49946b2c17d9:DattEx/src/main/java/com/temp/dattex/fragments/home/HomeFragment.java
import android.graphics.Color;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
<<<<<<< HEAD:DattEx/src/main/java/com/temp/buda/fragments/home/HomeFragment.java
import android.widget.TextView;

=======
>>>>>>> e7f6ac6e40e0fba4e4d97456712a49946b2c17d9:DattEx/src/main/java/com/temp/dattex/fragments/home/HomeFragment.java
import androidx.annotation.Nullable;
import androidx.databinding.Observable;
import androidx.fragment.app.Fragment;
import androidx.viewpager.widget.ViewPager;
import com.common.framework.basic.BaseFragment;
import com.exchange.utilslib.DisplayUtil;
import com.exchange.utilslib.ToastUtil;
import com.independ.framework.response.ResponseTransformer;
import com.jude.rollviewpager.RollPagerView;
import com.jude.rollviewpager.hintview.ColorPointHintView;
import com.sunfusheng.marqueeview.MarqueeView;
<<<<<<< HEAD:DattEx/src/main/java/com/temp/buda/fragments/home/HomeFragment.java
import com.temp.buda.BR;
import com.temp.buda.R;
import com.temp.buda.adapter.ImageNormalAdapter;
import com.temp.buda.adapter.PagerAdapter;
import com.temp.buda.bean.FuncListBean;
import com.temp.buda.bean.NoticeBean;
import com.temp.buda.databinding.FragmentHomeBinding;
import com.temp.buda.net.DataService;
import com.temp.buda.web.WebViewActivity;
import com.temp.buda.widget.view.HomeViewFlipper;

=======
import com.temp.dattex.BR;
import com.temp.dattex.R;
import com.temp.dattex.adapter.ImageNormalAdapter;
import com.temp.dattex.adapter.PagerAdapter;
import com.temp.dattex.bean.FuncListBean;
import com.temp.dattex.bean.NoticeBean;
import com.temp.dattex.databinding.FragmentHomeBinding;
import com.temp.dattex.net.DataService;
import com.temp.dattex.web.WebViewActivity;
>>>>>>> e7f6ac6e40e0fba4e4d97456712a49946b2c17d9:DattEx/src/main/java/com/temp/dattex/fragments/home/HomeFragment.java
import org.greenrobot.eventbus.EventBus;
import java.util.ArrayList;
import java.util.List;
import me.relex.circleindicator.CircleIndicator;

/*************************************************************************
 * Description   :
 *
 * @PackageName  : com.temp.dattex.fragments.home
 * @FileName     : HomeFragment.java
 * @Author       : chao
 * @Date         : 2020/5/18
 * @Email        : icechliu@gmail.com
 * @version      : V1
 *
 *                    .::::.
 *                  .::::::::.
 *                 :::::::::::  
 *             ..:::::::::::'
 *           '::::::::::::'
 *             .::::::::::
 *        '::::::::::::::..
 *             ..::::::::::::.
 *           ``::::::::::::::::
 *            ::::``:::::::::'        .:::.
 *           ::::'   ':::::'       .::::::::.
 *         .::::'      ::::     .:::::::'::::.
 *        .:::'       :::::  .:::::::::' ':::::.
 *       .::'        :::::.:::::::::'      ':::::.
 *      .::'         ::::::::::::::'         ``::::.
 *  ...:::           ::::::::::::'              ``::.
 * ```` ':.          ':::::::::'                  ::::..
 *                    '.:::::'                    ':'````..
 *************************************************************************/
public class HomeFragment extends BaseFragment<FragmentHomeBinding, HomePageViewModel> {
    private ViewPager view_pager,functionViewPager;
    private PagerAdapter mAdapter,functionAdapter;
    private List<FuncListBean.AndroidBean> listBeans = new ArrayList<>();
    ArrayList<Fragment> list;
    private RelativeLayout rlMarketTitle;
    private List<NoticeBean.RowsBean> noticeList = new ArrayList<>();
    private HomeViewFlipper viewFlipper;

    @Override
    public int initContentView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        return R.layout.fragment_home;
    }

    @Override
    public int initVariableId() {
        return BR.homeViewModel;
    }

    @Override
    public void stopLoad() {
    }

    @Override
    public void lazyLoad() {
    }

    @Override
    public void initView() {
        initData();
        initViews();
    }
    @Override
    public void onStart() {
        super.onStart();
    }

    @Override
    public void onStop() {
        super.onStop();
    }
    @Override
    public void onPause() {
            super.onPause();
        list.get(0).onPause();
    }

    private void initData() {
        Notice();
        ArrayList<Fragment> functionList = new ArrayList<>();
        functionViewPager = getActivity().findViewById(R.id.function_view_pager);
        functionAdapter = new PagerAdapter(getActivity().getSupportFragmentManager(), functionList);
        functionViewPager.setCurrentItem(0);  //初始化显示第一个页面
        CircleIndicator indicator2 = (CircleIndicator)getActivity(). findViewById(R.id.function_indicator);
        DataService.getInstance().getFuncList().compose(ResponseTransformer.<FuncListBean>handleResult()).subscribe(
                b -> {
                    dismissLoading();
                    listBeans = b.getAndroid();
                    for (int i = 0; i < listBeans.size(); i++) {
                             int j =0;
                            if(i%2==0){
                                j++;
                                functionList.add(new HomeFunctionFragment(j-1,listBeans));
                                functionViewPager.setAdapter(functionAdapter);
                                functionAdapter.notifyDataSetChanged();
                                indicator2.setViewPager(functionViewPager);
                                indicator2.setVisibility(View.GONE);
                            }
                    }
                }, t -> {
                    dismissLoading();
                    ToastUtil.show(getActivity(),t.getMessage());
                });
    }

    private void initViews() {
<<<<<<< HEAD:DattEx/src/main/java/com/temp/buda/fragments/home/HomeFragment.java
=======
         marqueeView = getActivity().findViewById(R.id.marqueeView);
         marqueeView.setOnItemClickListener((position, textView) -> {
             if (!messages.contains("暂无公告") && messages.size()>0){
                 Bundle bundle = new Bundle();
                 bundle.putString(WebViewActivity.KEY_PARAM_TITLE, "公告");
                 bundle.putString(WebViewActivity.KEY_PARAM_URL, "http://45.132.238.178/#/article?id="+noticeList.get(position).getId());
                 startActivity(WebViewActivity.class, bundle);
             }else {
                 System.out.println("------暂无公告");
             }
         });
>>>>>>> e7f6ac6e40e0fba4e4d97456712a49946b2c17d9:DattEx/src/main/java/com/temp/dattex/fragments/home/HomeFragment.java
         LinearLayout   notice = getActivity().findViewById(R.id.notice);
         notice.setOnClickListener(view -> {
//             startActivity(NoticeActivity.class);
        });

        list = new ArrayList<>();
        list.add(new HomeViewPagerFragment(0));
        view_pager = getActivity().findViewById(R.id.view_pager);
        mAdapter = new PagerAdapter(getActivity().getSupportFragmentManager(), list);
        view_pager.setAdapter(mAdapter);
        view_pager.setCurrentItem(0);  //初始化显示第一个页面
        CircleIndicator indicator = (CircleIndicator)getActivity(). findViewById(R.id.indicator);
        indicator.setViewPager(view_pager);
        indicator.setVisibility(View.GONE);
        //初始化ViewPager
//        ArrayList<Fragment> functionList = new ArrayList<>();
//        functionList.add(new HomeFunctionFragment(0));
//        functionList.add(new HomeFunctionFragment(1));
//        functionViewPager = getActivity().findViewById(R.id.function_view_pager);
//        functionAdapter = new PagerAdapter(getActivity().getSupportFragmentManager(), functionList);
//        functionViewPager.setAdapter(functionAdapter);
//        functionViewPager.setCurrentItem(0);  //初始化显示第一个页面
//        CircleIndicator indicator2 = (CircleIndicator)getActivity(). findViewById(R.id.function_indicator);
//        indicator2.setViewPager(functionViewPager);
        ImageView iv_ip = getActivity().findViewById(R.id.iv_ip);
        iv_ip.setOnClickListener(view -> {
        Bundle bundle = new Bundle();
        bundle.putString(WebViewActivity.KEY_PARAM_URL, "http://kf.dattex.cc/php/app.php?widget-mobile");
        startActivity(WebViewActivity.class, bundle);
        });
        RollPagerView vp_roll = getActivity().findViewById(R.id.vp_roll);
        vp_roll.setAdapter(new ImageNormalAdapter());//设置适配器
        vp_roll.setHintView(new ColorPointHintView(getActivity(), Color.TRANSPARENT, Color.TRANSPARENT));//设置指示器颜色
        vp_roll.setHintPadding(0,0, DisplayUtil.getScreenHardwareWidth(getActivity())/2 - 60,40);
        rlMarketTitle  = getActivity().findViewById(R.id.rl_market_title);

        viewFlipper = getActivity().findViewById(R.id.viewFlipper);

    }

    @Override
    public void onResume() {
        super.onResume();

    }

    @Override
    public void initViewObservable() {
        viewModel.checkRank.addOnPropertyChangedCallback(new Observable.OnPropertyChangedCallback() {
            @Override
            public void onPropertyChanged(Observable sender, int propertyId) {
                if (viewModel.checkRank.get()==3){
                    rlMarketTitle.setVisibility(View.VISIBLE);
                }else {
                    rlMarketTitle.setVisibility(View.GONE);
                }
            }
        });
        viewModel.list.addOnPropertyChangedCallback(new Observable.OnPropertyChangedCallback() {
            @Override
            public void onPropertyChanged(Observable sender, int propertyId) {
            }
        });
    }

    private void Notice (){
        DataService.getInstance().getNotice(1,1,1,1).compose(ResponseTransformer.handleResult()).subscribe(
                b -> {
                    if (b.getRows()==null||b.getRows().size()<=0){
                        View itemVp = View.inflate(getActivity(), R.layout.item_view_flipper, null);
                        TextView tv_title = itemVp.findViewById(R.id.tv_title);
                        tv_title.setText("暂无公告");


                        
                    }else {
                        noticeList = b.getRows();
                        for (int i = 0; i < b.getRows().size(); i++) {
                            View itemVp = View.inflate(getActivity(), R.layout.item_view_flipper, null);
                            TextView tv_title = itemVp.findViewById(R.id.tv_title);
                            String announceTitle = b.getRows().get(i).getTitle();
                            int id = b.getRows().get(i).getId();
                            tv_title.setText(announceTitle);
                            itemVp.setOnClickListener(view -> {
                                Bundle bundle = new Bundle();
                                bundle.putString(WebViewActivity.KEY_PARAM_TITLE, "公告");
                                bundle.putString(WebViewActivity.KEY_PARAM_URL, "http://45.132.238.178/#/article?id="+id);
                                startActivity(WebViewActivity.class, bundle);
                            });
                            viewFlipper.addView(itemVp);
                        }
                        viewFlipper.startFlipping();
                    }
<<<<<<< HEAD:DattEx/src/main/java/com/temp/buda/fragments/home/HomeFragment.java
=======
                    marqueeView.startWithList(messages);
>>>>>>> e7f6ac6e40e0fba4e4d97456712a49946b2c17d9:DattEx/src/main/java/com/temp/dattex/fragments/home/HomeFragment.java
                }, t -> {
                    ToastUtil.show(getActivity(),"获取公告失败"+t.getMessage());
                });
    }

    @Override
    public void onDestroy() {
        super.onDestroy();
        EventBus.getDefault().unregister(this);
    }
}
